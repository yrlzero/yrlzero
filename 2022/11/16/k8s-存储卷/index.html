<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yrlzero.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="存储卷介绍pod有生命周期，生命周期结束后pod里的数据会消失(如配置文件,业务数据等)。  需要将数据与pod分离,将数据放在专门的存储卷上  pod在k8s集群的节点中是可以调度的, 如果pod挂了被调度到另一个节点,那么数据和pod的联系会中断。  需要与集群节点分离的存储系统才能实现数据持久化  简单来说: volume提供了在容器上挂载外部存储的能力">
<meta property="og:type" content="article">
<meta property="og:title" content="K8s-存储卷">
<meta property="og:url" content="http://yrlzero.github.io/2022/11/16/k8s-%E5%AD%98%E5%82%A8%E5%8D%B7/index.html">
<meta property="og:site_name" content="yrl&#39;s blog">
<meta property="og:description" content="存储卷介绍pod有生命周期，生命周期结束后pod里的数据会消失(如配置文件,业务数据等)。  需要将数据与pod分离,将数据放在专门的存储卷上  pod在k8s集群的节点中是可以调度的, 如果pod挂了被调度到另一个节点,那么数据和pod的联系会中断。  需要与集群节点分离的存储系统才能实现数据持久化  简单来说: volume提供了在容器上挂载外部存储的能力">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yrlzero.github.io/images/k8s-%E5%AD%98%E5%82%A8%E5%8D%B7/%E6%88%AA%E5%9B%BE27.png">
<meta property="article:published_time" content="2022-11-16T03:27:09.511Z">
<meta property="article:modified_time" content="2022-11-16T06:56:46.319Z">
<meta property="article:author" content="yrl">
<meta property="article:tag" content="K8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yrlzero.github.io/images/k8s-%E5%AD%98%E5%82%A8%E5%8D%B7/%E6%88%AA%E5%9B%BE27.png">

<link rel="canonical" href="http://yrlzero.github.io/2022/11/16/k8s-%E5%AD%98%E5%82%A8%E5%8D%B7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>K8s-存储卷 | yrl's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">yrl's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yrlzero.github.io/2022/11/16/k8s-%E5%AD%98%E5%82%A8%E5%8D%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="yrl">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yrl's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          K8s-存储卷
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-11-16 11:27:09 / 修改时间：14:56:46" itemprop="dateCreated datePublished" datetime="2022-11-16T11:27:09+08:00">2022-11-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/devops/" itemprop="url" rel="index"><span itemprop="name">devops</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/devops/K8s/" itemprop="url" rel="index"><span itemprop="name">K8s</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="存储卷介绍"><a href="#存储卷介绍" class="headerlink" title="存储卷介绍"></a>存储卷介绍</h1><p>pod有生命周期，生命周期结束后pod里的数据会消失(如配置文件,业务数据等)。</p>
<blockquote>
<p>需要将数据与pod分离,将数据放在专门的存储卷上</p>
</blockquote>
<p>pod在k8s集群的节点中是可以调度的, 如果pod挂了被调度到另一个节点,那么数据和pod的联系会中断。</p>
<blockquote>
<p>需要与集群节点分离的存储系统才能实现数据持久化</p>
</blockquote>
<p>简单来说: <strong>volume提供了在容器上挂载外部存储的能力</strong></p>
<a id="more"></a>

<h1 id="存储卷的分类"><a href="#存储卷的分类" class="headerlink" title="存储卷的分类"></a>存储卷的分类</h1><p><code>kubectl explain pod.spec.volumes</code>或者参考: <a href="https://kubernetes.io/docs/concepts/storage/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/</a></p>
<ul>
<li>本地存储卷 <ul>
<li>emptyDir    pod删除,数据也会被清除, 用于数据的临时存储</li>
<li>hostPath     宿主机目录映射(本地存储卷)</li>
</ul>
</li>
<li>网络存储卷<ul>
<li>NAS类           nfs等</li>
<li>SAN类           iscsi,FC等</li>
<li>分布式存储   glusterfs,cephfs,rbd,cinder等</li>
<li>云存储           aws,azurefile等</li>
</ul>
</li>
</ul>
<h1 id="存储卷的选择"><a href="#存储卷的选择" class="headerlink" title="存储卷的选择"></a>存储卷的选择</h1><p>按应用角度主要分为三类:</p>
<ul>
<li>文件存储  如:nfs,glusterfs,cephfs等<ul>
<li>优点: 数据共享(多pod挂载可以同读同写)</li>
<li>缺点: 性能较差</li>
</ul>
</li>
<li>块存储  如: iscsi,rbd等<ul>
<li>优点: 性能相对于文件存储好</li>
<li>缺点: 不能实现数据共享（部分）</li>
</ul>
</li>
<li>对象存储 如: ceph对象存储<ul>
<li>优点: 性能好, 数据共享</li>
<li>缺点: 使用方式特殊,支持较少</li>
</ul>
</li>
</ul>
<h1 id="本地存储卷–emptyDir"><a href="#本地存储卷–emptyDir" class="headerlink" title="本地存储卷–emptyDir"></a>本地存储卷–emptyDir</h1><ul>
<li><p>应用场景</p>
<p>实现pod内容器之间数据共享</p>
</li>
<li><p>特点</p>
<p>随着pod被删除，该卷也会被删除</p>
</li>
</ul>
<h2 id="创建yaml文件"><a href="#创建yaml文件" class="headerlink" title="创建yaml文件"></a>创建yaml文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim volume-emptydir.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: volume-emptydir</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: write</span><br><span class="line">    image: centos</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">"bash"</span>,<span class="string">"-c"</span>,<span class="string">"echo haha &gt; /data/1.txt ; sleep 6000"</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: data</span><br><span class="line">      mountPath: /data</span><br><span class="line"></span><br><span class="line">  - name: <span class="built_in">read</span></span><br><span class="line">    image: centos</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">"bash"</span>,<span class="string">"-c"</span>,<span class="string">"cat /data/1.txt; sleep 6000"</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: data</span><br><span class="line">      mountPath: /data</span><br><span class="line">      </span><br><span class="line">  volumes:</span><br><span class="line">  - name: data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基于yaml文件创建pod"><a href="#基于yaml文件创建pod" class="headerlink" title="基于yaml文件创建pod"></a>基于yaml文件创建pod</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f volume-emptydir.yml</span></span><br><span class="line">pod/volume-emptydir created</span><br></pre></td></tr></table></figure>

<h2 id="查看pod启动情况"><a href="#查看pod启动情况" class="headerlink" title="查看pod启动情况"></a>查看pod启动情况</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pods |grep volume-emptydir</span></span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">volume-emptydir                    2/2     Running   0          15s</span><br></pre></td></tr></table></figure>

<h2 id="查看pod描述信息"><a href="#查看pod描述信息" class="headerlink" title="查看pod描述信息"></a>查看pod描述信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl describe pod volume-emptydir | tail -10</span></span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  50s   default-scheduler  Successfully assigned default/volume-emptydir to k8s-worker1</span><br><span class="line">  Normal  Pulling    50s   kubelet            Pulling image <span class="string">"centos:centos7"</span></span><br><span class="line">  Normal  Pulled     28s   kubelet            Successfully pulled image <span class="string">"centos:centos7"</span> <span class="keyword">in</span> 21.544912361s</span><br><span class="line">  Normal  Created    28s   kubelet            Created container write</span><br><span class="line">  Normal  Started    28s   kubelet            Started container write</span><br><span class="line">  Normal  Pulled     28s   kubelet            Container image <span class="string">"centos:centos7"</span> already present on machine</span><br><span class="line">  Normal  Created    28s   kubelet            Created container <span class="built_in">read</span></span><br><span class="line">  Normal  Started    28s   kubelet            Started container <span class="built_in">read</span></span><br></pre></td></tr></table></figure>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl logs volume-emptydir -c write</span></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl logs volume-emptydir -c read</span></span><br><span class="line">haha</span><br></pre></td></tr></table></figure>

<h1 id="本地存储卷–hostPath"><a href="#本地存储卷–hostPath" class="headerlink" title="本地存储卷–hostPath"></a>本地存储卷–hostPath</h1><ul>
<li><p>应用场景</p>
<p>pod内与集群节点目录映射（pod中容器想访问节点上数据，例如监控，只有监控访问到节点主机文件才能知道集群节点主机状态）</p>
</li>
<li><p>缺点</p>
<p>如果集群节点挂掉，控制器在另一个集群节点拉起容器，数据就会变成另一台集群节点主机的了（无法实现数据共享)</p>
</li>
</ul>
<h2 id="创建yaml文件-1"><a href="#创建yaml文件-1" class="headerlink" title="创建yaml文件"></a>创建yaml文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim volume-hostpath.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: volume-hostpath</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox</span><br><span class="line">    image: busybox</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">"/bin/sh"</span>,<span class="string">"-c"</span>,<span class="string">"echo haha &gt; /data/1.txt ; sleep 600"</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: data</span><br><span class="line">      mountPath: /data</span><br><span class="line">      </span><br><span class="line">  volumes:</span><br><span class="line">  - name: data</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /opt</span><br><span class="line">      <span class="built_in">type</span>: Directory</span><br></pre></td></tr></table></figure>

<h2 id="基于yaml文件创建pod-1"><a href="#基于yaml文件创建pod-1" class="headerlink" title="基于yaml文件创建pod"></a>基于yaml文件创建pod</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply  -f volume-hostpath.yml</span></span><br><span class="line">pod/volume-hostpath created</span><br></pre></td></tr></table></figure>

<h2 id="查看pod状态"><a href="#查看pod状态" class="headerlink" title="查看pod状态"></a>查看pod状态</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pods -o wide |grep volume-hostpath</span></span><br><span class="line">volume-hostpath     1/1   Running   0    29s     10.224.194.120   k8s-worker1   &lt;none&gt;     &lt;none&gt;</span><br><span class="line"><span class="comment">#可以看到pod是在k8s-worker1节点上</span></span><br></pre></td></tr></table></figure>

<h2 id="验证pod所在机器上的挂载文件"><a href="#验证pod所在机器上的挂载文件" class="headerlink" title="验证pod所在机器上的挂载文件"></a>验证pod所在机器上的挂载文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-worker1 ~]<span class="comment"># cat /opt/1.txt</span></span><br><span class="line">haha</span><br></pre></td></tr></table></figure>

<h1 id="网络存储卷–nfs"><a href="#网络存储卷–nfs" class="headerlink" title="网络存储卷–nfs"></a>网络存储卷–nfs</h1><h2 id="搭建nfs服务器"><a href="#搭建nfs服务器" class="headerlink" title="搭建nfs服务器"></a>搭建nfs服务器</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@nfsserver ~]<span class="comment"># mkdir -p /data/nfs</span></span><br><span class="line">[root@nfsserver ~]<span class="comment"># vim /etc/exports</span></span><br><span class="line">/data/nfs       *(rw,no_root_squash,sync)</span><br><span class="line">[root@nfsserver ~]<span class="comment"># systemctl restart nfs-server</span></span><br><span class="line">[root@nfsserver ~]<span class="comment"># systemctl enable nfs-server</span></span><br></pre></td></tr></table></figure>

<h2 id="所有node节点安装nfs客户端相关软件包"><a href="#所有node节点安装nfs客户端相关软件包" class="headerlink" title="所有node节点安装nfs客户端相关软件包"></a>所有node节点安装nfs客户端相关软件包</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-worker1 ~]<span class="comment"># yum install nfs-utils -y</span></span><br><span class="line">[root@k8s-worker2 ~]<span class="comment"># yum install nfs-utils -y</span></span><br></pre></td></tr></table></figure>

<h2 id="验证nfs可用性"><a href="#验证nfs可用性" class="headerlink" title="验证nfs可用性"></a>验证nfs可用性</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># showmount -e 192.168.10.129</span></span><br><span class="line">Export list <span class="keyword">for</span> 192.168.10.129:</span><br><span class="line">/data/nfs *</span><br><span class="line"></span><br><span class="line">[root@node2 ~]<span class="comment"># showmount -e 192.168.10.129</span></span><br><span class="line">Export list <span class="keyword">for</span> 192.168.10.129:</span><br><span class="line">/data/nfs *</span><br></pre></td></tr></table></figure>

<h2 id="master节点上创建yaml文件"><a href="#master节点上创建yaml文件" class="headerlink" title="master节点上创建yaml文件"></a>master节点上创建yaml文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim volume-nfs.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: volume-nfs</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.15-alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: documentroot</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">      volumes:</span><br><span class="line">      - name: documentroot</span><br><span class="line">        nfs:</span><br><span class="line">          server: 192.168.10.129</span><br><span class="line">          path: /data/nfs</span><br></pre></td></tr></table></figure>

<h2 id="应用yaml创建"><a href="#应用yaml创建" class="headerlink" title="应用yaml创建"></a>应用yaml创建</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment">#  kubectl apply -f volume-nfs.yml</span></span><br><span class="line">deployment.apps/nginx-deployment created</span><br></pre></td></tr></table></figure>

<h2 id="在nfs服务器共享目录中创建验证文件"><a href="#在nfs服务器共享目录中创建验证文件" class="headerlink" title="在nfs服务器共享目录中创建验证文件"></a>在nfs服务器共享目录中创建验证文件</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@nfsserver ~]<span class="comment"># echo "volume-nfs" &gt; /data/nfs/index.html</span></span><br></pre></td></tr></table></figure>

<h2 id="验证pod"><a href="#验证pod" class="headerlink" title="验证pod"></a>验证pod</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pod |grep volume-nfs</span></span><br><span class="line">volume-nfs-649d848b57-qg4bz   1/1     Running   0          10s</span><br><span class="line">volume-nfs-649d848b57-wrnpn   1/1     Running   0          10s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl exec -it volume-nfs-649d848b57-qg4bz -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># ls /usr/share/nginx/html/</span></span><br><span class="line">index.html</span><br><span class="line">/ <span class="comment"># cat /usr/share/nginx/html/index.html</span></span><br><span class="line">volume-nfs										<span class="comment"># 文件内容与nfs服务器上创建的一致</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl exec -it volume-nfs-649d848b57-wrnpn -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># ls /usr/share/nginx/html/</span></span><br><span class="line">index.html</span><br><span class="line">/ <span class="comment"># cat /usr/share/nginx/html/index.html</span></span><br><span class="line">volume-nfs										<span class="comment"># 文件内容与nfs服务器上创建的一致</span></span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>

<h1 id="PV-持久存储卷-与PVC-持久存储卷声明"><a href="#PV-持久存储卷-与PVC-持久存储卷声明" class="headerlink" title="PV(持久存储卷)与PVC(持久存储卷声明)"></a>PV(持久存储卷)与PVC(持久存储卷声明)</h1><h2 id="persistenvolume-PV"><a href="#persistenvolume-PV" class="headerlink" title="persistenvolume(PV)"></a>persistenvolume(<strong>PV</strong>)</h2><ul>
<li><p>PV是配置好的一段存储(可以是任意类型的存储卷)</p>
</li>
<li><p>也就是说将网络存储共享出来,配置定义成PV。</p>
</li>
</ul>
<h2 id="PersistentVolumeClaim-PVC"><a href="#PersistentVolumeClaim-PVC" class="headerlink" title="PersistentVolumeClaim(PVC)"></a>PersistentVolumeClaim(<strong>PVC</strong>)</h2><ul>
<li><p>PVC是用户pod使用PV的申请请求。</p>
</li>
<li><p>用户不需要关心具体的volume实现细节,只需要关心使用需求。</p>
</li>
</ul>
<h2 id="pv与pvc之间的关系"><a href="#pv与pvc之间的关系" class="headerlink" title="pv与pvc之间的关系"></a>pv与pvc之间的关系</h2><ul>
<li>pv提供存储资源(生产者)</li>
<li>pvc使用存储资源(消费者)</li>
<li>使用pvc绑定pv</li>
</ul>
<img src="/images/k8s-存储卷/截图27.png" alt="截图27" style="zoom:67%;" />

<h2 id="实现nfs类型pv与pvc"><a href="#实现nfs类型pv与pvc" class="headerlink" title="实现nfs类型pv与pvc"></a>实现nfs类型pv与pvc</h2><h3 id="编写创建pv的YAML文件"><a href="#编写创建pv的YAML文件" class="headerlink" title="编写创建pv的YAML文件"></a>编写创建pv的YAML文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim pv-nfs.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume						<span class="comment"># 类型为PersistentVolume(pv)</span></span><br><span class="line">metadata:		</span><br><span class="line">  name: pv-nfs								<span class="comment"># 名称</span></span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 1Gi							<span class="comment"># 大小</span></span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany							<span class="comment"># 访问模式</span></span><br><span class="line">  nfs:</span><br><span class="line">    path: /data/nfs							<span class="comment"># nfs共享目录</span></span><br><span class="line">    server: 192.168.10.129					<span class="comment"># nfs服务器IP</span></span><br></pre></td></tr></table></figure>

<p>访问模式有3种       参考: <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes</a></p>
<ul>
<li>ReadWriteOnce 单节点读写挂载</li>
<li>ReadOnlyMany  多节点只读挂载</li>
<li>ReadWriteMany  多节点读写挂载</li>
</ul>
<h3 id="创建pv并验证"><a href="#创建pv并验证" class="headerlink" title="创建pv并验证"></a>创建pv并验证</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f pv-nfs.yml</span></span><br><span class="line">persistentvolume/pv-nfs created</span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pv</span></span><br><span class="line">NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">pv-nfs   1Gi        RWX            Retain           Available                                   81s</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>RWX为ReadWriteMany的简写</li>
<li>Retain是回收策略  <ul>
<li>Retain表示需要不使用了需要手动回收</li>
<li>参考: <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#reclaim-policy" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/persistent-volumes/#reclaim-policy</a></li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="编写创建pvc的YAML文件"><a href="#编写创建pvc的YAML文件" class="headerlink" title="编写创建pvc的YAML文件"></a>编写创建pvc的YAML文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim pvc-nfs.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim				<span class="comment"># 类型为PersistentVolumeClaim(pvc)</span></span><br><span class="line">metadata:</span><br><span class="line">  name: pvc-nfs							<span class="comment"># pvc的名称</span></span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany						<span class="comment"># 访问模式</span></span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 1Gi						<span class="comment"># 大小要与pv的大小保持一致</span></span><br></pre></td></tr></table></figure>

<h3 id="创建pvc并验证"><a href="#创建pvc并验证" class="headerlink" title="创建pvc并验证"></a>创建pvc并验证</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f pvc-nfs.yml</span></span><br><span class="line">persistentvolumeclaim/pvc-nfs created</span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pvc</span></span><br><span class="line">NAME      STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">pvc-nfs   Bound    pv-nfs   1Gi        RWX                           38s</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意:</strong> STATUS必须为Bound状态(Bound状态表示pvc与pv绑定OK)</p>
</blockquote>
<h3 id="编写deployment的YMAL"><a href="#编写deployment的YMAL" class="headerlink" title="编写deployment的YMAL"></a>编写deployment的YMAL</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim deploy-nginx-nfs.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: deploy-nginx-nfs</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:1.15-alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: www</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">      volumes:</span><br><span class="line">      - name: www</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: pvc-nfs</span><br></pre></td></tr></table></figure>

<h3 id="应用YAML创建deploment"><a href="#应用YAML创建deploment" class="headerlink" title="应用YAML创建deploment"></a>应用YAML创建deploment</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f deploy-nginx-nfs.yml</span></span><br><span class="line">deployment.apps/deploy-nginx-nfs created</span><br></pre></td></tr></table></figure>

<h3 id="验证pod-1"><a href="#验证pod-1" class="headerlink" title="验证pod"></a>验证pod</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pod |grep deploy-nginx-nfs</span></span><br><span class="line">deploy-nginx-nfs-6f9bc4546c-gbzcl   1/1     Running   0          1m46s</span><br><span class="line">deploy-nginx-nfs-6f9bc4546c-hp4cv   1/1     Running   0          1m46s</span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl exec -it deploy-nginx-nfs-6f9bc4546c-gbzcl -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># ls /usr/share/nginx/html/</span></span><br><span class="line">index.html</span><br><span class="line">/ <span class="comment"># cat /usr/share/nginx/html/index.html</span></span><br><span class="line">volume-nfs</span><br><span class="line">/ <span class="comment"># exit</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl exec -it deploy-nginx-nfs-6f9bc4546c-hp4cv -- /bin/sh</span></span><br><span class="line">/ <span class="comment"># ls /usr/share/nginx/html/</span></span><br><span class="line">index.html</span><br><span class="line">/ <span class="comment"># cat /usr/share/nginx/html/index.html</span></span><br><span class="line">volume-nfs</span><br><span class="line">/ <span class="comment"># exit</span></span><br></pre></td></tr></table></figure>

<h1 id="存储的动态供给"><a href="#存储的动态供给" class="headerlink" title="存储的动态供给"></a>存储的动态供给</h1><p>每次使用存储要先创建pv, 再创建pvc，真累!   所以我们可以实现使用存储的动态供给特性。</p>
<ul>
<li>静态存储需要用户申请PVC时保证容量和读写类型与预置PV的容量及读写类型完全匹配, 而动态存储则无需如此.</li>
<li>管理员无需预先创建大量的PV作为存储资源</li>
</ul>
<p>Kubernetes从1.4版起引入了一个新的资源对象StorageClass，可用于将存储资源定义为具有显著特性的类（Class）而不是具体</p>
<p>的PV。用户通过PVC直接向意向的类别发出申请，匹配由管理员事先创建的PV，或者由其按需为用户动态创建PV，这样就免去</p>
<p>了需要先创建PV的过程。</p>
<h2 id="使用NFS文件系统创建存储动态供给"><a href="#使用NFS文件系统创建存储动态供给" class="headerlink" title="使用NFS文件系统创建存储动态供给"></a>使用NFS文件系统创建存储动态供给</h2><p>PV对存储系统的支持可通过其插件来实现，目前，Kubernetes支持如下类型的插件。</p>
<p>官方地址：<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/storage/storage-classes/</a></p>
<p>官方插件是不支持NFS动态供给的，但是我们可以用第三方的插件来实现</p>
<p>第三方插件地址: <a href="https://github.com/kubernetes-retired/external-storage" target="_blank" rel="noopener">https://github.com/kubernetes-retired/external-storage</a></p>
<h3 id="下载并创建storageclass"><a href="#下载并创建storageclass" class="headerlink" title="下载并创建storageclass"></a>下载并创建storageclass</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># wget https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/class.yaml</span></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># mv class.yaml storageclass-nfs.yml</span></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># cat storageclass-nfs.yml</span></span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass				<span class="comment"># 类型</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client		<span class="comment"># 名称,要使用就需要调用此名称</span></span><br><span class="line">provisioner: k8s-sigs.io/nfs-subdir-external-provisioner 	<span class="comment"># 动态供给插件</span></span><br><span class="line">parameters:</span><br><span class="line">  archiveOnDelete: <span class="string">"false"</span>		<span class="comment"># 删除数据时是否存档，false表示不存档，true表示存档</span></span><br><span class="line">  </span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f storageclass-nfs.yml</span></span><br><span class="line">storageclass.storage.k8s.io/managed-nfs-storage created</span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get storageclass</span></span><br><span class="line">NAME         PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE</span><br><span class="line">nfs-client   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           <span class="literal">false</span>                  10s</span><br><span class="line"></span><br><span class="line"><span class="comment"># RECLAIMPOLICY pv回收策略，pod或pvc被删除后，pv是否删除还是保留。</span></span><br><span class="line"><span class="comment"># VOLUMEBINDINGMODE Immediate 模式下PVC与PV立即绑定，主要是不等待相关Pod调度完成，不关心其运行节点，直接完成绑定。相反的 WaitForFirstConsumer模式下需要等待Pod调度完成后进行PV绑定。</span></span><br><span class="line"><span class="comment"># ALLOWVOLUMEEXPANSION pvc扩容</span></span><br></pre></td></tr></table></figure>

<h3 id="下载并创建rbac"><a href="#下载并创建rbac" class="headerlink" title="下载并创建rbac"></a>下载并创建rbac</h3><p>因为storage自动创建pv需要经过kube-apiserver，所以需要授权。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># wget https://raw.githubusercontent.com/kubernetes-sigs/nfs-subdir-external-provisioner/master/deploy/rbac.yaml</span></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># mv rbac.yaml storageclass-nfs-rbac.yaml</span></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># cat storageclass-nfs-rbac.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner</span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  namespace: default</span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner-runner</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"persistentvolumes"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"delete"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"persistentvolumeclaims"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"update"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">"storage.k8s.io"</span>]</span><br><span class="line">    resources: [<span class="string">"storageclasses"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"events"</span>]</span><br><span class="line">    verbs: [<span class="string">"create"</span>, <span class="string">"update"</span>, <span class="string">"patch"</span>]</span><br><span class="line">---</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: run-nfs-client-provisioner</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: nfs-client-provisioner</span><br><span class="line">    <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">    namespace: default</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: nfs-client-provisioner-runner</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">---</span><br><span class="line">kind: Role</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: leader-locking-nfs-client-provisioner</span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  namespace: default</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups: [<span class="string">""</span>]</span><br><span class="line">    resources: [<span class="string">"endpoints"</span>]</span><br><span class="line">    verbs: [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"update"</span>, <span class="string">"patch"</span>]</span><br><span class="line">---</span><br><span class="line">kind: RoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: leader-locking-nfs-client-provisioner</span><br><span class="line">  <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">  namespace: default</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: nfs-client-provisioner</span><br><span class="line">    <span class="comment"># replace with namespace where provisioner is deployed</span></span><br><span class="line">    namespace: default</span><br><span class="line">roleRef:</span><br><span class="line">  kind: Role</span><br><span class="line">  name: leader-locking-nfs-client-provisioner</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f rbac.yaml</span></span><br><span class="line">serviceaccount/nfs-client-provisioner created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created</span><br><span class="line">role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created</span><br></pre></td></tr></table></figure>

<h3 id="创建动态供给的deployment"><a href="#创建动态供给的deployment" class="headerlink" title="创建动态供给的deployment"></a>创建动态供给的deployment</h3><p>需要一个deployment来专门实现pv与pvc的自动创建</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]<span class="comment"># vim deploy-nfs-client-provisioner.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nfs-client-provisioner</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  strategy:</span><br><span class="line">    <span class="built_in">type</span>: Recreate</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nfs-client-provisioner</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nfs-client-provisioner</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccount: nfs-client-provisioner</span><br><span class="line">      containers:</span><br><span class="line">        - name: nfs-client-provisioner</span><br><span class="line">          image: registry.cn-beijing.aliyuncs.com/pylixm/nfs-subdir-external-provisioner:v4.0.0</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: nfs-client-root</span><br><span class="line">              mountPath: /persistentvolumes</span><br><span class="line">          env:</span><br><span class="line">            - name: PROVISIONER_NAME</span><br><span class="line">              value: k8s-sigs.io/nfs-subdir-external-provisioner</span><br><span class="line">            - name: NFS_SERVER</span><br><span class="line">              value: 192.168.10.129</span><br><span class="line">            - name: NFS_PATH</span><br><span class="line">              value: /data/nfs</span><br><span class="line">      volumes:</span><br><span class="line">        - name: nfs-client-root</span><br><span class="line">          nfs:</span><br><span class="line">            server: 192.168.10.129</span><br><span class="line">            path: /data/nfs</span><br><span class="line">           </span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl apply -f deploy-nfs-client-provisioner.yml</span></span><br><span class="line">deployment.apps/nfs-client-provisioner created</span><br><span class="line"></span><br><span class="line">[root@k8s-master1 ~]<span class="comment"># kubectl get pods |grep nfs-client-provisioner</span></span><br><span class="line">nfs-client-provisioner-5b5ddcd6c8-b6zbq   1/1     Running   0          34s</span><br></pre></td></tr></table></figure>

<p>测试存储动态供给是否可用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim nginx-sc.yaml</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    name: web</span><br><span class="line">  clusterIP: None</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata:</span><br><span class="line">  name: web</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  serviceName: <span class="string">"nginx"</span></span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: huoban-harbor</span><br><span class="line">      terminationGracePeriodSeconds: 10</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          name: web</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: www</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">  volumeClaimTemplates:</span><br><span class="line">  - metadata:</span><br><span class="line">      name: www</span><br><span class="line">    spec:</span><br><span class="line">      accessModes: [ <span class="string">"ReadWriteOnce"</span> ]</span><br><span class="line">      storageClassName: <span class="string">"nfs-client"</span></span><br><span class="line">      resources:</span><br><span class="line">        requests:</span><br><span class="line">          storage: 1Gi</span><br><span class="line">          </span><br><span class="line">[root@k8s-master1 nfs]<span class="comment"># kubectl get pods</span></span><br><span class="line">NAME                                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nfs-client-provisioner-9c988bc46-pr55n   1/1     Running   0          95s</span><br><span class="line">web-0                                    1/1     Running   0          95s</span><br><span class="line">web-1                                    1/1     Running   0          61s</span><br><span class="line"></span><br><span class="line">[root@nfsserver ~]<span class="comment"># ls /data/nfs/</span></span><br><span class="line">default-www-web-0-pvc-c4f7aeb0-6ee9-447f-a893-821774b8d11f  default-www-web-1-pvc-8b8a4d3d-f75f-43af-8387-b7073d07ec01</span><br></pre></td></tr></table></figure>

<blockquote>
<p>批量下载文件：<br>for file in class.yaml deployment.yaml rbac.yaml  ; do wget <a href="https://raw.githubusercontent.com/kubernetes-incubator/external-storage/master/nfs-client/deploy/$file" target="_blank" rel="noopener">https://raw.githubusercontent.com/kubernetes-incubator/external-storage/master/nfs-client/deploy/$file</a> ; done</p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/K8s/" rel="tag"># K8s</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/11/15/k8s-controller/" rel="prev" title="K8s-controller">
      <i class="fa fa-chevron-left"></i> K8s-controller
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/11/16/DevOps/" rel="next" title="DevOps-CICD">
      DevOps-CICD <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#存储卷介绍"><span class="nav-text">存储卷介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#存储卷的分类"><span class="nav-text">存储卷的分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#存储卷的选择"><span class="nav-text">存储卷的选择</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#本地存储卷–emptyDir"><span class="nav-text">本地存储卷–emptyDir</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建yaml文件"><span class="nav-text">创建yaml文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于yaml文件创建pod"><span class="nav-text">基于yaml文件创建pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看pod启动情况"><span class="nav-text">查看pod启动情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看pod描述信息"><span class="nav-text">查看pod描述信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证"><span class="nav-text">验证</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#本地存储卷–hostPath"><span class="nav-text">本地存储卷–hostPath</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建yaml文件-1"><span class="nav-text">创建yaml文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基于yaml文件创建pod-1"><span class="nav-text">基于yaml文件创建pod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看pod状态"><span class="nav-text">查看pod状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证pod所在机器上的挂载文件"><span class="nav-text">验证pod所在机器上的挂载文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#网络存储卷–nfs"><span class="nav-text">网络存储卷–nfs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#搭建nfs服务器"><span class="nav-text">搭建nfs服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#所有node节点安装nfs客户端相关软件包"><span class="nav-text">所有node节点安装nfs客户端相关软件包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证nfs可用性"><span class="nav-text">验证nfs可用性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#master节点上创建yaml文件"><span class="nav-text">master节点上创建yaml文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#应用yaml创建"><span class="nav-text">应用yaml创建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在nfs服务器共享目录中创建验证文件"><span class="nav-text">在nfs服务器共享目录中创建验证文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证pod"><span class="nav-text">验证pod</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PV-持久存储卷-与PVC-持久存储卷声明"><span class="nav-text">PV(持久存储卷)与PVC(持久存储卷声明)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#persistenvolume-PV"><span class="nav-text">persistenvolume(PV)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PersistentVolumeClaim-PVC"><span class="nav-text">PersistentVolumeClaim(PVC)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pv与pvc之间的关系"><span class="nav-text">pv与pvc之间的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实现nfs类型pv与pvc"><span class="nav-text">实现nfs类型pv与pvc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编写创建pv的YAML文件"><span class="nav-text">编写创建pv的YAML文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建pv并验证"><span class="nav-text">创建pv并验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写创建pvc的YAML文件"><span class="nav-text">编写创建pvc的YAML文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建pvc并验证"><span class="nav-text">创建pvc并验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写deployment的YMAL"><span class="nav-text">编写deployment的YMAL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#应用YAML创建deploment"><span class="nav-text">应用YAML创建deploment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证pod-1"><span class="nav-text">验证pod</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#存储的动态供给"><span class="nav-text">存储的动态供给</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用NFS文件系统创建存储动态供给"><span class="nav-text">使用NFS文件系统创建存储动态供给</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下载并创建storageclass"><span class="nav-text">下载并创建storageclass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#下载并创建rbac"><span class="nav-text">下载并创建rbac</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建动态供给的deployment"><span class="nav-text">创建动态供给的deployment</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="yrl"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">yrl</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">113</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">59</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yrl</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  
</body>
</html>
